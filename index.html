<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P3R æ”»ç•¥æ‰‹å†Œ</title>
    <style>
        :root {
            --p3-dark: #10141a;
            --p3-blue: #00d2ff; /* P3R é’è‰² */
            --p3-blue-dim: #005a70;
            --p3-accent: #d4e3e8;
            --p3-card-bg: rgba(20, 25, 35, 0.9);
            --text-main: #ffffff;
            --text-sub: #a0c4d4;
            --shadow: 0 4px 20px rgba(0, 210, 255, 0.15);
            --sidebar-width: 280px;
        }

        body {
            background-color: #050505;
            background-image: linear-gradient(160deg, #0b1016 0%, #1a253a 100%);
            color: var(--text-main);
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden; /* é˜²æ­¢æ¨ªå‘æ»šåŠ¨ */
        }

        /* --- å¸ƒå±€å®¹å™¨ (Flexbox) --- */
        .app-wrapper {
            display: flex;
            min-height: 100vh;
        }

        /* --- å·¦ä¾§ä¾§è¾¹æ æ ·å¼ --- */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(10, 15, 20, 0.95);
            border-right: 2px solid var(--p3-blue-dim);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            overflow-y: auto;
            padding: 20px 10px;
            box-sizing: border-box;
            z-index: 100;
            scrollbar-width: thin;
            scrollbar-color: var(--p3-blue-dim) transparent;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background-color: var(--p3-blue-dim);
        }

        .toc-title {
            color: var(--p3-blue);
            font-size: 1.2rem;
            text-transform: uppercase;
            text-align: center;
            border-bottom: 1px solid var(--p3-blue-dim);
            padding-bottom: 10px;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        /* ç›®å½•åˆ—è¡¨æ ·å¼ */
        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-list ul {
            list-style: none;
            padding-left: 15px;
            display: none; /* é»˜è®¤æŠ˜å  */
            border-left: 1px dashed rgba(0, 210, 255, 0.3);
        }

        .toc-list li {
            margin: 5px 0;
        }

        .toc-link {
            display: block;
            color: var(--text-sub);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .toc-link:hover {
            color: #fff;
            background: rgba(0, 210, 255, 0.1);
        }

        /* å±•å¼€/æŠ˜å å›¾æ ‡ */
        .toc-toggle {
            display: inline-block;
            width: 15px;
            margin-right: 5px;
            cursor: pointer;
            color: var(--p3-blue);
            font-size: 0.8rem;
            transition: transform 0.2s;
        }
        
        .toc-item.expanded > .toc-link > .toc-toggle {
            transform: rotate(90deg);
        }

        .toc-item.expanded > ul {
            display: block; /* å±•å¼€æ˜¾ç¤º */
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å±‚çº§ç¼©è¿›å¾®è°ƒ */
        .toc-level-1 > .toc-link { font-weight: bold; color: var(--p3-blue); font-size: 1rem; }
        .toc-level-2 > .toc-link { font-weight: 600; }
        .toc-level-3 > .toc-link { font-size: 0.85rem; }

        /* --- å³ä¾§ä¸»å†…å®¹åŒºåŸŸ --- */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width); /* ä¸ºä¾§è¾¹æ ç•™å‡ºç©ºé—´ */
            padding: 20px 40px;
            max-width: 1200px; /* å†…å®¹æœ€å¤§å®½åº¦ */
        }

        /* --- åŸæœ‰æ ·å¼ä¿ç•™ä¸å¾®è°ƒ --- */
        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid var(--p3-blue);
            margin-bottom: 40px;
            background: radial-gradient(circle at center, rgba(0, 210, 255, 0.1) 0%, transparent 70%);
        }

        h1 {
            font-size: 3rem;
            margin: 0;
            color: var(--p3-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.5);
        }

        h2 {
            border-left: 5px solid var(--p3-blue);
            padding-left: 15px;
            margin-top: 50px;
            margin-bottom: 25px;
            font-size: 2rem;
            color: #fff;
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.1), transparent);
            padding-top: 5px;
            padding-bottom: 5px;
            scroll-margin-top: 20px; /* è·³è½¬æ—¶ç•™å‡ºé¡¶éƒ¨é—´è· */
        }

        h3 {
            color: var(--p3-blue);
            margin-bottom: 10px;
            font-size: 1.4rem;
            scroll-margin-top: 20px;
        }

        h4 {
            color: var(--p3-blue);
            margin-bottom: 10px;
            font-size: 1.4rem;
            scroll-margin-top: 20px;
        }

        a { color: var(--p3-blue); text-decoration: none; transition: 0.3s; }
        .tool-link { display: inline-block; background: rgba(0, 210, 255, 0.1); border: 1px solid var(--p3-blue); padding: 10px 20px; margin: 5px; border-radius: 4px; font-weight: bold; }
        .tool-link:hover { background: var(--p3-blue); color: #000; box-shadow: 0 0 15px var(--p3-blue); }

        .tips-box { background: rgba(255, 255, 255, 0.05); border: 1px dashed var(--p3-blue-dim); padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .tips-box ul { padding-left: 20px; }
        .tips-box li { margin-bottom: 8px; color: var(--text-sub); }
        .star { color: #ffeb3b; text-shadow: 0 0 5px #ffeb3b; }

        /* --- å›¾ç‰‡æ ·å¼ (å¢åŠ ç‚¹å‡»æ”¾å¤§æ‰‹åŠ¿) --- */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            border: 1px solid #333;
            display: block;
            margin: 10px 0;
            cursor: zoom-in; /* æç¤ºå¯ç‚¹å‡» */
            transition: transform 0.2s;
        }
        img:hover {
            transform: scale(1.01);
            box-shadow: 0 6px 12px var(--p3-blue);
        }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .coop-card { background: var(--p3-card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 20px; transition: transform 0.2s, box-shadow 0.2s; position: relative; overflow: hidden; }
        .coop-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--p3-blue); }
        .coop-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--p3-blue); }
        .coop-info p { margin: 5px 0; color: var(--text-sub); font-size: 0.95rem; }
        .coop-info strong { color: #fff; }

        .table-wrapper { overflow-x: auto; margin: 20px 0; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        table { width: 100%; border-collapse: collapse; background: #1a1f29; min-width: 600px; }
        th { background: var(--p3-blue-dim); color: #fff; padding: 12px; text-align: left; font-weight: bold; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #2c3e50; color: var(--text-sub); }
        tr:hover td { background: rgba(0, 210, 255, 0.05); color: #fff; }

        .location-section { background: rgba(0,0,0,0.3); padding: 20px; margin-bottom: 20px; border-radius: 10px; }
        .highlight { color: var(--p3-blue); font-weight: bold; }
        .price { color: #ff6b6b; font-family: monospace; }
        .salary { color: #6bff8b; font-family: monospace; }

        .back-to-top { position: fixed; bottom: 30px; right: 30px; background: var(--p3-blue); color: #000; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; box-shadow: 0 0 10px var(--p3-blue); opacity: 0.8; z-index: 90; }
        
        .big-img-container { text-align: center; margin: 20px 0; }
        .big-img-container img { max-width: 80%; margin: 0 auto; border: 2px solid var(--p3-blue); }

        /* --- å›¾ç‰‡ç¯ç®± (Lightbox) æ ·å¼ --- */
        .lightbox-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .lightbox-modal.active {
            display: flex;
            opacity: 1;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            border: 2px solid var(--p3-blue);
            box-shadow: 0 0 30px var(--p3-blue);
            border-radius: 4px;
            object-fit: contain;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            .sidebar.mobile-active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                padding: 10px;
            }
            /* ç§»åŠ¨ç«¯èœå•æŒ‰é’® */
            .mobile-menu-btn {
                display: block;
                position: fixed;
                top: 10px;
                left: 10px;
                background: var(--p3-blue);
                padding: 10px;
                border-radius: 5px;
                z-index: 101;
                color: #000;
                font-weight: bold;
            }
        }
        @media (min-width: 769px) {
            .mobile-menu-btn { display: none; }
        }

    </style>
</head>
<body>

<!-- ç¯ç®±å®¹å™¨ -->
<div id="lightbox" class="lightbox-modal">
    <img id="lightbox-img" class="lightbox-content" src="" alt="Zoomed Image">
</div>

<!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
<div class="mobile-menu-btn" onclick="toggleMobileSidebar()">â˜° ç›®å½•</div>

<div class="app-wrapper">
    <!-- å·¦ä¾§ç›®å½• -->
    <nav class="sidebar" id="sidebar">
        <div class="toc-title">ç³»ç»Ÿèœå•</div>
        <ul class="toc-list" id="toc-root">
            <!-- JS å°†åœ¨æ­¤å¤„ç”Ÿæˆç›®å½• -->
        </ul>
    </nav>

    <!-- å³ä¾§å†…å®¹ -->
    <main class="main-content" id="content-area">
        
        <header>
            <h1>Persona 3 Reload</h1>
            <p style="color: var(--text-sub); letter-spacing: 5px;">æ”»ç•¥æ¡£æ¡ˆ / S.E.E.S DATABASE</p>
            <div style="margin-top: 20px;">
                <a href="assets/persona_fusion_calc.html" class="tool-link" target="_blank">ğŸ­ é˜¿å°”å¡é‚£åˆæˆå·¥å…·</a>
                <a href="https://aqiu384.github.io/megaten-fusion-tool/zh-cn/p3r/personas" class="tool-link" target="_blank">ğŸ”— P3R åˆä½“è®¡ç®—å™¨ (Web)</a>
            </div>
        </header>

        <!-- ç¤¾ç¾¤æ”»ç•¥ -->
        <section>
            <h2>ç¤¾ç¾¤æ”»ç•¥ (Coop)</h2>
            
            <div class="tips-box">
                <h4>ğŸ“… æ´»åŠ¨æ—¶é—´æ¦‚è§ˆ</h4>
                <div class="big-img-container">
                    <img src="assets/coopä¸€è§ˆ.png" alt="coopä¸€è§ˆå›¾è¡¨">
                </div>
                <ul>
                    <li><strong>ä¼‘æ¯æ—¥ï¼š</strong>æŒ‡æ˜¯å¦èƒ½åœ¨å¯’æš‘å‡ç­‰ä¼‘æ¯æ—¥æ¨è¿›Coopã€‚</li>
                    <li><strong>è€ƒè¯•é™åˆ¶ï¼š</strong>æœŸä¸­æœŸæœ«è€ƒè¯•å‰ä¸€å‘¨æ— æ³•æ¨è¿›æ ¡å†…å’Œé˜Ÿå‹Coopï¼ˆ<span class="highlight">ã€å¥³çš‡ã€‘æ¡æ¡ç¾é¹¤é™¤å¤–</span>ï¼‰ã€‚</li>
                    <li><span class="star">â­ï¸</span> <strong>ã€éšè€…ã€‘&ã€å¤ªé˜³ã€‘ï¼š</strong>ä»…å¯åœ¨å‘¨æ—¥è¿›è¡Œã€‚</li>
                    <li><span class="star">â­ï¸</span> <strong>ã€å¥³çš‡ã€‘&ã€æ°¸åŠ«ã€‘ï¼š</strong>è§£é”è¾ƒæ™šï¼Œæ—¶é—´ç´§ä»»åŠ¡é‡ï¼Œä¼˜å…ˆå®‰æ’ã€‚</li>
                    <li><span class="star">â­ï¸</span> <strong>æ—¶é—´ç®¡ç†ï¼š</strong>å·¥ä½œæ—¥ä¸‹åˆå°½é‡æ¨æ ¡å†…Coopï¼ˆæ•°é‡å¤šã€æ—¶é—´å°‘ï¼‰ã€‚</li>
                    <li><span class="star">â­ï¸</span> <strong>ç‰¹æ®Šé¢å…·ï¼š</strong>æ¬¡å¹´1æœˆåå’ŒåŒä¼´çš„ç‰¹æ®Šå‰§æƒ…ä¼šè§£é”é¢å…·ã€‚</li>
                </ul>
            </div>

            <h3>ğŸ« æ ¡å†… Coop</h3>
            <div class="grid-container">
                <!-- é­”æœ¯å¸ˆ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>I. é­”æœ¯å¸ˆ (å‹è¿‘ å¥äºŒ)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ•™å®¤å†…</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨äºŒã€å››ã€äº”</p>
                        <img src="assets/é­”æœ¯å¸ˆcoop.png" alt="é­”æœ¯å¸ˆ">
                    </div>
                </div>
                <!-- æˆ˜è½¦ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>VII. æˆ˜è½¦ (å®«æœ¬ ä¸€å¿—)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ“åœº</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨ä¸€ã€äºŒã€å››ã€äº”</p>
                        <img src="assets/æˆ˜è½¦coop.png" alt="æˆ˜è½¦">
                    </div>
                </div>
                <!-- çš‡å¸ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>IV. çš‡å¸ (å°ç”°æ¡ ç§€åˆ©)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>å­¦ç”Ÿä¼šåŠå…¬å®¤</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨ä¸€ã€ä¸‰ã€äº”</p>
                        <img src="assets/çš‡å¸coop.png" alt="çš‡å¸">
                    </div>
                </div>
                <!-- åŠ›é‡ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XI. åŠ›é‡ (è¥¿èƒ ç»“å­)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ•™å®¤å¤–èµ°å»Š</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨ä¸‰ã€å…­</p>
                        <img src="assets/åŠ›é‡coop.png" alt="åŠ›é‡">
                    </div>
                </div>
                <!-- æ­£ä¹‰ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>VIII. æ­£ä¹‰ (ä¼è§ åƒå¯»)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>å­¦ç”Ÿä¼šåŠå…¬å®¤é—¨å£</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨äºŒã€å››ã€å…­</p>
                        <img src="assets/æ­£ä¹‰coop.png" alt="æ­£ä¹‰">
                    </div>
                </div>
                <!-- èŠ‚åˆ¶ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XIV. èŠ‚åˆ¶ (è´åŸ¹)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>äºŒæ¥¼æ•™å®¤é—¨å£/å®¶åº­ç§‘æ•™å®¤</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨äºŒã€ä¸‰ã€äº”</p>
                        <img src="assets/èŠ‚åˆ¶coop.png" alt="èŠ‚åˆ¶">
                    </div>
                </div>
                <!-- å‘½è¿ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>X. å‘½è¿ (å¹³è´º åº†ä»‹)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>ä¸€æ¥¼ç¾æœ¯æ•™å®¤</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨äºŒã€ä¸‰ã€å››</p>
                        <img src="assets/å‘½è¿coop.png" alt="å‘½è¿">
                    </div>
                </div>
            </div>

            <h3>ğŸ™ï¸ ç¤¾ä¼š Coop</h3>
            <div class="grid-container">
                <!-- æ•™çš‡ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>V. æ•™çš‡ (åŒ—æ‘ æ–‡å‰)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ—§ä¹¦åº— ä¹¦è™« (å•†åº—è¡—)</p>
                        <p><strong>æ—¶é—´ï¼š</strong>é™¤å‘¨ä¸€å¤–</p>
                        <img src="assets/æ•™çš‡coop.png" alt="æ•™çš‡">
                    </div>
                </div>
                <!-- éšè€… -->
                <div class="coop-card" style="border-color: #ffeb3b;">
                    <div class="coop-info">
                        <h4>IX. éšè€… (Yå­) <span class="star">â­ï¸</span></h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>è‡ªå·±çš„æˆ¿é—´ (ç”µè„‘)</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨æ—¥ã€ä¼‘æ¯æ—¥</p>
                        <img src="assets/éšè€…coop.png" alt="éšè€…">
                    </div>
                </div>
                <!-- å€’æ‚¬è€… -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XII. å€’æ‚¬è€… (å¤§æ¡¥ èˆå­)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>é•¿é¸£ç¥ç¤¾</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨ä¸€ã€ä¸‰ã€å…­ã€ä¼‘</p>
                        <img src="assets/å€’æ‚¬è€…coop.png" alt="å€’æ‚¬è€…">
                    </div>
                </div>
                <!-- æœˆ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XVIII. æœˆ (æœ«å…‰ æœ›ç¾)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ¡å¶è´­ç‰©ä¸­å¿ƒ</p>
                        <p><strong>æ—¶é—´ï¼š</strong>é™¤å‘¨å››å¤–</p>
                        <img src="assets/æœˆcoop.png" alt="æœˆ">
                    </div>
                </div>
                <!-- å¡” -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XVI. å¡” (æ— è¾¾å’Œå°š)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ”¾çºµä¿±ä¹éƒ¨ (æ™šä¸Š)</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨å››è‡³å‘¨æ—¥ã€ä¼‘æ¯æ—¥</p>
                        <img src="assets/å¡”coop.png" alt="å¡”">
                    </div>
                </div>
                <!-- æ¶é­” -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XV. æ¶é­” (ç”°ä¸­ç¤¾é•¿)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ¡å¶è´­ç‰©ä¸­å¿ƒ (æ™šä¸Š)</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨äºŒã€å…­</p>
                        <img src="assets/æ¶é­”coop.png" alt="æ¶é­”">
                    </div>
                </div>
                <!-- æ˜Ÿ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>XVII. æ˜Ÿ (æ—©æ¿‘ æŠ¤)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>å•†åº—è¡— (é•¿æ¤…)</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨äºŒã€ä¸‰ã€äº”ã€æ—¥ã€ä¼‘</p>
                        <img src="assets/æ˜Ÿcoop.png" alt="æ˜Ÿ">
                    </div>
                </div>
                <!-- å¤ªé˜³ -->
                <div class="coop-card" style="border-color: #ffeb3b;">
                    <div class="coop-info">
                        <h4>XIX. å¤ªé˜³ (ç¥æœ¨ ç§‹æˆ) <span class="star">â­ï¸</span></h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>é•¿é¸£ç¥ç¤¾</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨æ—¥ä¸‹åˆ</p>
                        <img src="assets/å¤ªé˜³coop.png" alt="å¤ªé˜³">
                    </div>
                </div>
            </div>

            <h3>ğŸ›¡ï¸ é˜Ÿå†… Coop (S.E.E.S)</h3>
            <div class="grid-container">
                <!-- å¥³æ•™çš‡ -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>II. å¥³æ•™çš‡ (å±±å²¸ é£èŠ±)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>äºŒæ¥¼æ•™å®¤å¤–èµ°å»Š</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨ä¸€ã€äº”ã€å…­</p>
                        <img src="assets/å¥³æ•™çš‡coop.png" alt="å¥³æ•™çš‡">
                    </div>
                </div>
                <!-- æ‹çˆ± -->
                <div class="coop-card">
                    <div class="coop-info">
                        <h4>VI. æ‹çˆ± (å²³ç¾½ ç”±åŠ è‰)</h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ•™å®¤</p>
                        <p><strong>æ—¶é—´ï¼š</strong>å‘¨ä¸€ã€ä¸‰ã€å››ã€å…­</p>
                        <img src="assets/æ‹çˆ±coop.png" alt="æ‹çˆ±">
                    </div>
                </div>
                <!-- å¥³çš‡ -->
                <div class="coop-card" style="border-color: #ffeb3b;">
                    <div class="coop-info">
                        <h4>III. å¥³çš‡ (æ¡æ¡ ç¾é¹¤) <span class="star">â­ï¸</span></h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>ä¸€æ¥¼å¤§å… (å¾…ç¡®è®¤)</p>
                        <p><strong>æ—¶é—´ï¼š</strong>é™¤å‘¨æ—¥å¤–</p>
                        <p style="color: #ff6b6b; font-size: 0.8rem;">âš ï¸ 7-8çº§ç¬¬3ä¸ªé—®é¢˜é€‰â€œæ¬¢è¿éšæ—¶å€¾è¯‰â€è¿›æ‹äººçº¿</p>
                        <img src="assets/å¥³çš‡coop.png" alt="å¥³çš‡">
                    </div>
                </div>
                <!-- æ°¸åŠ« -->
                <div class="coop-card" style="border-color: #ffeb3b;">
                    <div class="coop-info">
                        <h4>XX. æ°¸åŠ« (åŸƒç™¸æ–¯) <span class="star">â­ï¸</span></h4>
                        <p><strong>åœ°ç‚¹ï¼š</strong>æ•™å®¤å†…</p>
                        <p><strong>æ—¶é—´ï¼š</strong>é™¤å‘¨æ—¥å¤–</p>
                        <img src="assets/æ°¸åŠ«coop.png" alt="æ°¸åŠ«">
                    </div>
                </div>
            </div>
        </section>

        <!-- å¤§åœ°å›¾ -->
        <section>
            <h2>å¤§åœ°å›¾ & è®¾æ–½æŒ‡å—</h2>

            <!-- å­¦ç”Ÿå®¿èˆ -->
            <div class="location-section">
                <h3>ğŸ¢ å­¦ç”Ÿå®¿èˆ</h3>

                <h4>å¸¸è§„æ´»åŠ¨</h4>
                
                <div class="tips-box">
                    <p><span class="star">â­ï¸</span> <strong>ä¸åŒä¼´å…±åº¦æ—¶å…‰ï¼š</strong>å¯è§£é”åŒä¼´é¢å…·ç‰¹æ€§ï¼›10æœˆåˆä¼šæœ‰åŒä¼´ç¦»é˜Ÿï¼ŒåŠ¡å¿…åœ¨æ­¤ä¹‹å‰è§£é”å…¨å‘˜1çº§ç‰¹æ€§ã€‚è§£é”1çº§ç‰¹æ€§åç»§ç»­äº’åŠ¨å¯è§£é”2çº§ç‰¹æ€§ã€‚</p>
                </div>

                <ul>
                    <li><strong>è€ƒå‰ä¸€èµ·å­¦ä¹ ï¼š</strong>å­¦åŠ› +4</li>
                    <li><strong>è€ƒå‰å¤§å‹å­¦ä¹ ä¼šï¼š</strong>å­¦åŠ› +5</li>
                    <li><strong>å…¬ç”¨ç”µè„‘ï¼š</strong>å¯ä½¿ç”¨ä»â€œæ¼«ç”»ä¹‹æ˜Ÿâ€å’Œâ€œæ”¾çºµä¿±ä¹éƒ¨â€è´­ä¹°çš„è½¯ä»¶</li>
                    <li><strong>ç”µè§† <span class="star">â­ï¸</span>ï¼š</strong>ç”°ä¸­è´­ç‰©é¢‘é“ï¼ˆæ¯å‘¨æ—¥ä¸Šåˆï¼‰</li>
                    <li><strong>å¨æˆ¿ï¼š</strong>å†°ç®±æ¸…ç†æ—¥å¯åˆ¶ä½œâ€œå†°é•‡é²·é±¼çƒ§â€ç­‰ç‰©å“ã€‚
                        <br><small style="color: #c7c7c7;">æ—¥æœŸï¼š5/2, 5/31, 6/16, 6/30, 7/29, 8/27, 9/13, 9/26, 10/25, 11/11, 12/10, 12/23, 1/9, 1/22</small>
                    </li>
                    <li><strong>å¤©å°ï¼š</strong>å¯ç§æ¤è”¬èœï¼ˆç”¨äºçƒ¹é¥ªæˆ–æˆ˜æ–—ç‰©å“ï¼‰</li>
                </ul>

                <h4>å…¬ç”¨ç”µè„‘è½¯ä»¶ä¸€è§ˆ</h4>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th width="30%">è½¯ä»¶åç§°</th>
                                <th>ä½œç”¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>é«˜å“ä½ç¤¼ä»ªæ•™å­¦ / çœ‹ä¸€çœ‹å°±èƒ½å‡ / å¿ƒè·³æŠ€å·§</td><td>é­…åŠ› +4</td></tr>
                            <tr><td>å±±é—´è¡¥ä¹ ç­ / MOBAè‹±è¯­å¯¹è¯ / è‹±æ‰è„‘é”»ç‚¼</td><td>å­¦åŠ› +4</td></tr>
                            <tr><td>åŠ¨ç‰©é»‘ç™½æ£‹ / PCæˆ˜å›½è®° / æ‰“å­—é£Ÿå°¸é¬¼</td><td>å‹‡æ°” +4</td></tr>
                            <tr><td>æ‰“å·¥çš„è§„èŒƒ</td><td>æ‰“å·¥å·¥èµ„æé«˜</td></tr>
                            <tr><td>ç§èœæ¨¡æ‹Ÿå™¨</td><td>å¢åŠ å¤©å°èœå›­æ”¶è´§æ•°é‡</td></tr>
                            <tr><td>è¶…çº§è‚Œè‚‰è®­ç»ƒè¥ / æƒ³è±¡é”»ç‚¼</td><td>HPæœ€å¤§å€¼æå‡ +7 / +9</td></tr>
                            <tr><td>å†¥æƒ³è®­ç»ƒè¥ / ä¸ä¼šå¤±è´¥çš„ç²¾ç¥é”»ç‚¼</td><td>SPæœ€å¤§å€¼æå‡ +5 / +7</td></tr>
                            <tr><td>æµ·ç‰›ç²‰ä¸æ‰‹å†Œ</td><td>è§£é”æµ·ç‰›é¤å…</td></tr>
                            <tr><td>åææƒ…æŠ¥ç«™çš„å­—æ¡</td><td>å­¦ä¼šæŠ€å·§â€œå¼ºè¢­æ”»å‡»â€</td></tr>
                            <tr><td>æš—æ€æ‹³ç½‘ç«™çš„å­—æ¡</td><td>å¼ºè¢­æ”»å‡»è·å¾—å¼ºåŒ–ï¼šå¿…å®šåŠ¨æ‘‡</td></tr>
                            <tr><td>å†å²å­¦æŠ•ç¨¿ç«™çš„å­—æ¡</td><td>å¼ºè¢­æ”»å‡»è·å¾—å¼ºåŒ–ï¼šæˆåŠŸæ—¶ï¼Œç¥é€šæ³•è®¡é‡æ¡ä¸Šå‡æé«˜</td></tr>
                            <tr><td>å¿è€…ç²‰ä¸ç«™çš„å­—æ¡</td><td>å¼ºè¢­æ”»å‡»è·å¾—å¼ºåŒ–ï¼šå†²åˆºéœ€è¦çš„å‡†å¤‡æ—¶é—´å‡å°‘</td></tr>
                            <tr><td>ç»“ç¼˜ç½‘ç«™çš„å­—æ¡ <span class="star">â­ï¸</span></td><td>è§£é”çº¿ä¸Šç»“ç¼˜ç¥ç­¾ (è¡¥å¥½æ„Ÿåº¦)</td></tr>
                            <tr><td>ä¸¥æˆ·å°/èœå›­åšå®¢ å­—æ¡</td><td>è§£é”å”®è´§æœºé¥®æ–™ç§ç±» / èŠ±åº—é»„é‡‘ç•ªèŒ„</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- é•¿é¸£ç¥ç¤¾ -->
            <div class="location-section">
                <h3>â›©ï¸ é•¿é¸£ç¥ç¤¾</h3>
                <ul>
                    <li><strong>ç¨»è·ç¥ å ‚ <span class="star">â­ï¸</span>ï¼š</strong>æ¯æ—¥å¯å¤åˆ¶ä¸€å¼ æŠ€èƒ½å¡ã€‚</li>
                    <li><strong>é¦™ç«é’±ï¼š</strong>
                        <ul>
                            <li>(<span class="price">ï¿¥100 / ï¿¥1000</span>) -> å­¦åŠ›+2</li>
                            <li>(<span class="price">ï¿¥10000</span>) -> å­¦åŠ›+5</li>
                        </ul>
                    </li>
                    <li><strong>ç»“ç¼˜ç¥ç­¾ <span class="star">â­ï¸</span>ï¼š</strong>æå‡æŒ‡å®šç¤¾ç¾¤å¥½æ„Ÿåº¦ (<span class="price">ï¿¥100</span>)ã€‚</li>
                </ul>
            </div>

            <!-- æ¡å¶è´­ç‰©ä¸­å¿ƒ -->
            <div class="location-section">
                <h3>ğŸ›ï¸ æ¡å¶è´­ç‰©ä¸­å¿ƒ</h3>
                <h4>å¸¸è§„æ´»åŠ¨</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                    <div style="flex: 1; min-width: 300px;">
                        <ul>
                            <li><strong>å¤©é¹…ç»’æˆ¿é—´ <span class="star">â­ï¸</span>ï¼š</strong>å¡æ‹‰OKä¸‹æ¥¼æ¢¯åä¾§å··å­ã€‚</li>
                            <li><strong>è¾°å·³ä¸œæ´¾å‡ºæ‰€ï¼š</strong>æ­¦å™¨é˜²å…·é¥°å“ (å‘¨ä¸€ä¿ƒé”€)ã€‚</li>
                            <li><strong>è“èƒ¡å­è¯æˆ¿ï¼š</strong>è¯å“ (å‘¨å…­ä¿ƒé”€)ã€‚</li>
                            <li><strong>çœŸå®µå ‚ï¼š</strong>å¤è‘£åº—ï¼Œåˆæˆé«˜çº§è£…å¤‡/å¡ç‰‡ã€‚</li>
                            <li><strong>æ”¾çºµä¿±ä¹éƒ¨ï¼š</strong>æƒ…æŠ¥(ç”µè„‘è½¯ä»¶)ã€å åœ(Buff)ã€å®çŸ³ã€‚</li>
                        </ul>
                    </div>
                    <div style="flex: 1; min-width: 300px;">
                        <ul>
                            <li><strong>å¡æ‹‰OK æ›¼å¾·æ‹‰è‰ï¼š</strong>å‹‡æ°”+2 (<span class="price">ï¿¥800</span>)</li>
                            <li><strong>å’–å•¡åº—å¤å¡å°”ï¼š</strong>é­…åŠ›+2 (<span class="price">ï¿¥500</span>) / æ‰“å·¥(ä¸€äºŒä¸‰)(<span class="salary">ï¿¥2500</span>)</li>
                            <li><strong>Be blue Vï¼š</strong>æ¢å¤é—å¿˜æŠ€èƒ½ (<span class="price">ï¿¥3000</span>) / æ‰“å·¥(å‘¨ä¸€è‡³äº”)(<span class="salary">ï¿¥3500</span>)</li>
                            <li><strong>ç”µç©å¤§æ”¾çºµ <span class="star">â­ï¸</span>ï¼š</strong>æå‡ä¸‰ç»´æˆ–é¢å…·äº”ç»´ï¼Œå…·ä½“ä¿¡æ¯è§ä¸‹è¡¨</li>
                        </ul>
                    </div>
                </div>

                <h4>ç”µç©å¤§æ”¾çºµ ä»·ç›®è¡¨</h4>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>æ˜ŸæœŸ</th>
                                <th>â­ï¸ èƒ½åŠ›å€¼æå‡ (äº”ç»´)</th>
                                <th>é¢å…·å±æ€§æå‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å‘¨ä¸€ã€å››</td>
                                <td>ã€Šé’æ˜¥é«˜æ ¡ã€‹é­…åŠ›+4 (<span class="price">ï¿¥1500</span>)</td>
                                <td>ã€Šé‡æ‹³æˆ˜å£«ã€‹åŠ›+3 (<span class="price">ï¿¥2000</span>)</td>
                            </tr>
                            <tr>
                                <td>å‘¨äºŒã€äº”</td>
                                <td>ã€Šæ­»äº¡ä¹‹æ€–ã€‹å‹‡æ°”+4 (<span class="price">ï¿¥3000</span>)</td>
                                <td>ã€Šå‘½å®šèµ›è½¦ã€‹é€Ÿ+3 (<span class="price">ï¿¥2000</span>)</td>
                            </tr>
                            <tr>
                                <td>å‘¨ä¸‰ã€å…­</td>
                                <td>ã€Šä½ å°±æ˜¯ç­”æ¡ˆã€‹å­¦åŠ›+4 (<span class="price">ï¿¥3000</span>)</td>
                                <td>ã€Šå åœä¹‹é¦†ã€‹é­”+3 (<span class="price">ï¿¥2000</span>)</td>
                            </tr>
                            <tr>
                                <td>å‘¨æ—¥</td>
                                <td>-</td>
                                <td>å…¨å±æ€§æ¸¸æˆå¼€æ”¾ (<span class="price">ï¿¥2000</span>)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ä¸¥æˆ·å°å•†åº—è¡— -->
            <div class="location-section">
                <h3>ğŸ” ä¸¥æˆ·å°ç«™å‰å•†åº—è¡—</h3>
                <h4>å¸¸è§„æ´»åŠ¨</h4>
                <ul>
                    <li><strong>æ€€è€é¸­æ±‰å ¡ <span class="star">â­ï¸</span>ï¼š</strong>æå‡å‹‡æ°”</li>
                    <li><strong>å®šé£Ÿ è‹¥æ´¥ <span class="star">â­ï¸</span>ï¼š</strong>æå‡å­¦åŠ›</li>
                    <li><strong>é”…å²›æ‹‰é¢ å¶éš <span class="star">â­ï¸</span>ï¼š</strong>æå‡é­…åŠ›</li>
                    <li><strong>æ¼«ç”»ä¹‹æ˜Ÿï¼š</strong>è´­ä¹°è½¯ä»¶</li>
                </ul>
                <div class="grid-container">
                    <div class="coop-card">
                        <h4>æ€€è€é¸­æ±‰å ¡èœå•</h4>
                        <p class="highlight">å¸¸è§„å¥—é¤</p>
                        <p>æ–°å“æ±‰å ¡å¥—é¤ï¼šå‹‡æ°”+3 (<span class="price">ï¿¥1000</span>)</p>
                        <p class="highlight">éšè—å¥—é¤</p>
                        <p>â­ï¸ å‘¨æœ«æ€€è€é¸­å¥—é¤ï¼šå‹‡æ°”+4 (<span class="price">ï¿¥1200</span>)</p>
                        <small>è§£é”æ¡ä»¶ï¼šå®Œæˆä¼Šä¸½èç™½å§”æ‰˜â€œå¤§èƒƒç‹æŒ‘æˆ˜â€</small>
                        </br>
                        <small>å¼€æ”¾æ—¶é—´ï¼šå‘¨å…­ã€æ—¥ æ™šä¸Š</small>
                        <p>å¤§èƒƒç‹æŒ‘æˆ˜ï¼šå…¨èƒ½åŠ›+4 (ä¼Šä¸½èç™½å§”æ‰˜è§£é”)</p>
                    </div>
                    
                    <div class="coop-card">
                        <h4>å®šé£Ÿ è‹¥æ´¥èœå•</h4>
                        <p class="highlight">å¸¸è§„å¥—é¤</p>
                        <p>DHAæ»¡æ»¡å¥—é¤ï¼šå­¦åŠ›+3 (<span class="price">ï¿¥680</span>)</p>
                        <p class="highlight">éšè—å¥—é¤</p>
                        <p>â­ï¸ æ°´äº§å…¨å¸­å¥—é¤ï¼šå­¦åŠ›+4 (<span class="price">ï¿¥900</span>)</p>
                        <small>è§£é”æ¡ä»¶ï¼šå‘¨ä¸€/å››/äº”/æ—¥ æ™šä¸Šåˆ°åº—ä½¿ç”¨å¸¸è§„å¥—é¤</small>
                        </br>
                        <small>å¼€æ”¾æ—¶é—´ï¼šå‘¨ä¸€/å››/äº”/æ—¥ æ™šä¸Š</small>
                    </div>

                    <div class="coop-card">
                        <h4>é”…å²›æ‹‰é¢ å¶éšèœå•</h4>
                        <p class="highlight">å¸¸è§„å¥—é¤</p>
                        <p>çŒªé¢ˆè‚‰é…±æ‹‰é¢ï¼šé­…åŠ›+3 (<span class="price">ï¿¥900</span>)</p>
                        <p class="highlight">éšè—å¥—é¤</p>
                        <p>â­ï¸ ç‰¹é€‰å¶éšç›–é¥­ï¼šé­…åŠ›+4 (<span class="price">ï¿¥1200</span>)</p>
                        <small>è§£é”æ¡ä»¶ï¼šå‘¨äºŒ/ä¸‰/äº” æ™šä¸Šåˆ°åº—ä½¿ç”¨å¸¸è§„å¥—é¤</small>
                        </br>
                        <small>å¼€æ”¾æ—¶é—´ï¼šå‘¨äºŒ/ä¸‰/äº” æ™šä¸Š</small>
                    </div>
                </div>
            </div>
            
            <!-- å…¶ä»– -->
             <div class="location-section">
                <h3>å…¶ä»–åœ°ç‚¹</h3>
                <ul>
                    <li><strong>æœˆå…‰é¦†å­¦é™¢ï¼š</strong>ä¸Šè¯¾ä¸è¦ç¡è§‰ï¼ˆæå‡å­¦åŠ›ï¼‰ã€‚</li>
                    <li><strong>æ¸¯æ¹¾äººå·¥å²› - è±å¼—å£«èŠ±åº—ï¼š</strong>è´­ä¹°èŠ±å‰ï¼ˆç¤¼ç‰©ï¼‰å’Œä½œç‰©ç§å­ã€‚</li>
                    <li><strong>æ¸¯æ¹¾äººå·¥å²› - ç”µå½±é™¢ï¼š</strong>çœ‹ç”µå½±ï¼ˆæå‡ä¸‰ç»´ï¼‰ï¼›æ‰“å·¥(å‘¨å…­ã€æ—¥)(<span class="salary">ï¿¥5000</span>)ã€‚</li>
                </ul>
            </div>

        </section>

        <footer style="text-align: center; margin-top: 50px; padding: 20px; color: #555; border-top: 1px solid #333;">
            <p>Persona 3 Reload Guide</p>
        </footer>

        <a href="#" class="back-to-top" title="è¿”å›é¡¶éƒ¨">â†‘</a>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- 1. è‡ªåŠ¨ç”Ÿæˆç›®å½• (TOC) é€»è¾‘ ---
        const contentArea = document.getElementById('content-area');
        const tocRoot = document.getElementById('toc-root');
        
        // è·å–æ‰€æœ‰ H1, H2, H3
        const headers = contentArea.querySelectorAll('h1, h2, h3');
        
        // è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºç›®å½•é¡¹ DOM ç»“æ„
        function createTocItem(header, level) {
            // ä¸ºæ ‡é¢˜ç”ŸæˆID (å¦‚æœä¸å­˜åœ¨)
            if (!header.id) {
                header.id = 'section-' + Math.random().toString(36).substr(2, 9);
            }
            
            const li = document.createElement('li');
            li.className = 'toc-item toc-level-' + level;
            
            const link = document.createElement('a');
            link.className = 'toc-link';
            
            // å±•å¼€å›¾æ ‡ (é»˜è®¤éšè—ï¼Œæœ‰å­å…ƒç´ æ—¶æ˜¾ç¤º)
            const toggleIcon = document.createElement('span');
            toggleIcon.className = 'toc-toggle';
            toggleIcon.innerHTML = 'â–¶'; 
            toggleIcon.style.opacity = '0'; // åˆå§‹å®Œå…¨é€æ˜
            
            const textSpan = document.createElement('span');
            textSpan.textContent = header.innerText;
            
            link.appendChild(toggleIcon);
            link.appendChild(textSpan);
            
            // ç‚¹å‡»æ–‡å­—è·³è½¬
            textSpan.addEventListener('click', (e) => {
                e.preventDefault();
                
                // --- ä¿®æ”¹å¼€å§‹ï¼šè‡ªå®šä¹‰åç§»è·³è½¬ ---
                const offset = 120; // è¿™é‡Œè®¾ç½®ä½ æƒ³è¦ä¿ç•™çš„é¡¶éƒ¨è·ç¦»ï¼ˆåƒç´ ï¼‰
                const elementPosition = header.getBoundingClientRect().top + window.scrollY;
                const offsetPosition = elementPosition - offset;
        
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
                // ç§»åŠ¨ç«¯ç‚¹å‡»åè‡ªåŠ¨æ”¶èµ·èœå•
                if(window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('mobile-active');
                }
            });
            
            // ç‚¹å‡»å›¾æ ‡æŠ˜å /å±•å¼€ (ç°åœ¨ç»‘å®šï¼Œä½†ç­‰å˜æˆçˆ¶çº§æ—¶æ‰æœ‰æ•ˆ)
            toggleIcon.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation(); // é˜²æ­¢è§¦å‘è·³è½¬
                li.classList.toggle('expanded');
            });

            li.appendChild(link);
            return { li, toggleIcon };
        }

        // --- æ ¸å¿ƒä¿®å¤é€»è¾‘ï¼šåŸºäºå±‚çº§çš„çˆ¶èŠ‚ç‚¹è¿½è¸ª ---
        
        // è®°å½•æ¯ä¸€ä¸ªå±‚çº§æœ€åæ·»åŠ çš„ LI èŠ‚ç‚¹
        // Level 0 æ˜¯è™šæ‹Ÿæ ¹èŠ‚ç‚¹ (tocRoot)
        const lastLiByLevel = {
            0: tocRoot 
        };

        headers.forEach(header => {
            const currentLevel = parseInt(header.tagName.substring(1)); // 1, 2, 3
            const { li, toggleIcon } = createTocItem(header, currentLevel);

            // 1. å¯»æ‰¾å½“å‰æ ‡é¢˜çš„çˆ¶çº§å®¹å™¨
            // æ­£å¸¸æƒ…å†µä¸‹ï¼ŒH3 çš„çˆ¶çº§åº”è¯¥æ˜¯ Level 2 çš„æœ€åä¸€ä¸ª LI
            // å¦‚æœæ–‡æ¡£ç»“æ„è·³è·ƒ (ä¾‹å¦‚ H1 ç›´æ¥æ¥ H3)ï¼Œåˆ™å‘ä¸Šå¯»æ‰¾æœ€è¿‘å­˜åœ¨çš„å±‚çº§
            let parentLevel = currentLevel - 1;
            while (parentLevel > 0 && !lastLiByLevel[parentLevel]) {
                parentLevel--;
            }
            
            // 2. è·å–çˆ¶èŠ‚ç‚¹ (å¯èƒ½æ˜¯ tocRoot æˆ–è€…æŸä¸ª LI)
            const parentNode = lastLiByLevel[parentLevel];
            
            // 3. ç¡®å®šæŒ‚è½½ç‚¹ (UL)
            let parentUl;
            if (parentLevel === 0) {
                // å¦‚æœçˆ¶çº§æ˜¯ 0ï¼Œè¯´æ˜æŒ‚è½½åˆ°æ ¹ç›®å½•
                parentUl = tocRoot;
            } else {
                // å¦‚æœçˆ¶çº§æ˜¯æŸä¸ª LIï¼Œæ£€æŸ¥å®ƒé‡Œé¢æœ‰æ²¡æœ‰ ULï¼Œæ²¡æœ‰åˆ™åˆ›å»º
                parentUl = parentNode.querySelector('ul');
                if (!parentUl) {
                    parentUl = document.createElement('ul');
                    parentNode.appendChild(parentUl);
                    
                    // --- å…³é”®ç‚¹ï¼šæ¿€æ´»çˆ¶çº§çš„æŠ˜å å›¾æ ‡ ---
                    // å› ä¸ºç°åœ¨ç»™å®ƒæ·»åŠ äº†å­å…ƒç´ ï¼Œæ‰€ä»¥å®ƒçš„å›¾æ ‡åº”è¯¥æ˜¾ç¤ºå‡ºæ¥
                    const parentToggle = parentNode.querySelector('.toc-toggle');
                    if (parentToggle) {
                        parentToggle.style.opacity = '1'; 
                        // é»˜è®¤å±•å¼€ H2 ä¸‹çš„ H3
                        if (parentLevel <= 2) { 
                            parentNode.classList.add('expanded'); 
                        }
                    }
                }
            }
            
            // 4. å°†å½“å‰ LI æ·»åŠ åˆ°çˆ¶çº§ UL ä¸­
            parentUl.appendChild(li);

            // 5. æ›´æ–°å½“å‰å±‚çº§çš„â€œæœ€åèŠ‚ç‚¹â€è®°å½•
            lastLiByLevel[currentLevel] = li;

            // 6. æ¸…é™¤æ¯”å½“å‰å±‚çº§æ›´æ·±çš„è®°å½•
            // (ä¾‹å¦‚ï¼šæ·»åŠ äº†ä¸€ä¸ªæ–°çš„ H2 åï¼Œä¹‹å‰çš„ H3 è®°å½•å°±å¤±æ•ˆäº†ï¼Œä¸èƒ½æŠŠæ–°çš„ H4 æŒ‚åˆ°æ—§çš„ H3 ä¸‹)
            for (let i = currentLevel + 1; i <= 6; i++) {
                lastLiByLevel[i] = null;
            }
        });

        // é»˜è®¤å±•å¼€ç¬¬ä¸€çº§çš„æ‰€æœ‰é¡¹
        const rootItems = tocRoot.children;
        for(let item of rootItems) {
            if(item.querySelector('ul')) {
                item.classList.add('expanded');
            }
        }


        // --- 2. å›¾ç‰‡ç¯ç®± (Lightbox) é€»è¾‘ (ä¿æŒä¸å˜) ---
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const allImages = document.querySelectorAll('.main-content img');

        allImages.forEach(img => {
            img.addEventListener('click', function() {
                lightboxImg.src = this.src;
                lightbox.classList.add('active');
            });
        });

        lightbox.addEventListener('click', function() {
            lightbox.classList.remove('active');
        });

        // --- 3. ç§»åŠ¨ç«¯èœå•åˆ‡æ¢ (ä¿æŒä¸å˜) ---
        window.toggleMobileSidebar = function() {
            document.getElementById('sidebar').classList.toggle('mobile-active');
        };
        
        contentArea.addEventListener('click', () => {
             document.getElementById('sidebar').classList.remove('mobile-active');
        });

        // --- 4. å›¾ç‰‡æœ¬åœ°ç¼“å­˜ç³»ç»Ÿ (æ–°å¢éƒ¨åˆ†) ---
        const CACHE_NAME = 'p3r-guide-img-cache-v1';

        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ Cache API
        if ('caches' in window) {
            const allImages = document.querySelectorAll('.main-content img'); // åªç¼“å­˜æ­£æ–‡å›¾ç‰‡
            
            caches.open(CACHE_NAME).then(async (cache) => {
                for (let img of allImages) {
                    const originalSrc = img.getAttribute('src');
                    
                    // è·³è¿‡æ²¡æœ‰ src æˆ–å·²ç»æ˜¯ blob (å·²å¤„ç†) çš„å›¾ç‰‡
                    if (!originalSrc || originalSrc.startsWith('blob:')) continue;

                    try {
                        // 1. å…ˆå°è¯•ä»ç¼“å­˜é‡Œæ‰¾
                        const cachedResponse = await cache.match(originalSrc);

                        if (cachedResponse) {
                            // A. å‘½ä¸­ç¼“å­˜ï¼šç›´æ¥è¯»å– Blob å¹¶ç”Ÿæˆæœ¬åœ° URL
                            const blob = await cachedResponse.blob();
                            const blobUrl = URL.createObjectURL(blob);
                            img.src = blobUrl;
                            // console.log('å·²ä»æœ¬åœ°ç¼“å­˜åŠ è½½:', originalSrc);
                        } else {
                            // B. æœªå‘½ä¸­ç¼“å­˜ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚å¹¶å­˜å…¥ç¼“å­˜
                            // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ fetch è·å–å›¾ç‰‡æ•°æ®
                            const networkResponse = await fetch(originalSrc, { 
                                mode: 'cors', // å…³é”®ï¼šè·¨åŸŸè¯·æ±‚éœ€è¦æœåŠ¡å™¨æ”¯æŒ
                                cache: 'no-cache' // å¼ºåˆ¶ç½‘ç»œè¯·æ±‚ï¼Œä¸è¯»æµè§ˆå™¨HTTPç¼“å­˜
                            });

                            if (networkResponse.ok) {
                                // å¤åˆ¶ä¸€ä»½å“åº”å­˜å…¥ç¼“å­˜ (response æµåªèƒ½è¯»ä¸€æ¬¡)
                                cache.put(originalSrc, networkResponse.clone());
                                
                                // åŒæ—¶æ›´æ–°å½“å‰é¡µé¢æ˜¾ç¤º
                                const blob = await networkResponse.blob();
                                const blobUrl = URL.createObjectURL(blob);
                                img.src = blobUrl;
                                // console.log('ä¸‹è½½å¹¶ç¼“å­˜æˆåŠŸ:', originalSrc);
                            }
                        }
                    } catch (err) {
                        // å¦‚æœè·¨åŸŸæŠ¥é”™æˆ–ç½‘ç»œå¤±è´¥ï¼Œä¿æŒåŸ src ä¸å˜ï¼Œè®©æµè§ˆå™¨é»˜è®¤åŠ è½½
                        console.warn('ç¼“å­˜å¤±è´¥ (å¯èƒ½æ˜¯è·¨åŸŸé—®é¢˜)ï¼Œå°†ä½¿ç”¨æ™®é€šåŠ è½½:', originalSrc, err);
                    }
                }
            });
        }
    });
</script>

</body>
</html>